{{if .GoTags}}//go:build {{.GoTags}}
{{end}}// Autogenerated by goserpent; DO NOT EDIT.

package {{.PackageName}}

/*
#cgo pkg-config: python3 python3-embed
#include <Python.h>
#include "{{.CHeaderFname}}"
*/
import "C"

{{if .Imports}}
import ({{range .Imports}}
	"{{.}}"{{end}}
){{end}}

func asGoBool(v C.int) bool {
	return v != 0
}

func pyObjectAsGoString(v *C.PyObject) string {
	cstr := C.PyObjectToChar(v)
	return C.GoString(cstr)
}

func asPyBool(v bool) *C.PyObject {
	if v {
		return C.PyIncRef(C.Py_True)
	} else {
		return C.PyIncRef(C.Py_False)
	}
}

func asPyLong[T int | int8 | int16 | int32 | int64 | uint | uint8 | uint16 | uint32 | uint64](v T) *C.PyObject {
	return C.PyIncRef(C.PyLong_FromLong(C.long(v)))
}

func asPyList[T any](vs []T, fn func(v T) *C.PyObject) *C.PyObject {
    list := C.PyList_New(C.long(len(vs)))
    for i, v := range vs {
        C.PyList_SetItem(list, C.long(i), fn(v))
    }
    return list
}

func asPyString(v string) *C.PyObject {
	return C.PyIncRef(C.PyUnicode_FromString(C.CString(v)))
}

func asPyFloat[T float32 | float64](v T) *C.PyObject {
	return C.PyIncRef(C.PyFloat_FromDouble(C.double(v)))
}

func asPyError(err error) *C.PyObject {
	if err == nil {
		return C.Py_None
	}
	C.PyErr_SetString(C.PyExc_RuntimeError, C.CString(err.Error()))
	return nil
}

{{range .RequiredCythonDictToGoMap}}{{template "cythondicttogomap" .}}{{end}}

{{range .Functions}}{{template "gopyexport" .}}{{end}}

{{range .Types}}
	func {{.GoTypeName}}ToPyObject(v *{{.GoTypeName}}) *C.PyObject {
		return C.new_{{.GoTypeName}}(C.uintptr_t(cgo.NewHandle(v)))
	}
	{{range .Methods}}{{template "gopyexport" .}}{{end}}
	{{range .Funcs}}{{template "gopyexport" .}}{{end}}
{{end}}
